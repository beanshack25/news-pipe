<!DOCTYPE html>
<head>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet">
  <style>
    * {
      font-family: "Inter", sans-serif;
      box-sizing: border-box;
      margin: 0;
    }

    .node {
      background-color: #eee;
      border: 2px solid #ccc;
      border-radius: 8px; 
      padding: 12px;
      width: 100%;
      height: 100%;
    }

    .node h1 {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .node p {
      font-size: 12px;
      font-weight: 400;
    }

    .tick {
      stroke: #ddd;
    }

    .axis {
      stroke: #222;
    }

    .label {
      fill: #222;
      font-weight: 600;
      text-anchor: middle;
      font-size: 12px;
    }
  </style>
</head>
<body>
<svg id="tree">
</svg>
<script>
  const oldest = 2000;
  const NODE_WIDTH = 0.5;
  const YEAR_WIDTH = 400;
  const HEIGHT = 120;
  const HEIGHT_GAP = 60;
  let newest = 2035;

  const depths = []

  function addNode(uid, title, summary, date) {
    for (let i = 0; i < depths.length; i++) {
      depths[i] = depths[i].filter(node => node.uid !== uid);
    }

    const dateObj = new Date(date);
    let year = dateObj.getFullYear();
    const startOfYear = new Date(year, 0, 1);
    const endOfYear = new Date(year + 1, 0, 1);
    const yearProgress = (dateObj - startOfYear) / (endOfYear - startOfYear);
    year += yearProgress;

    const upper = year + NODE_WIDTH;
    for (let i = 0; i < depths.length; i++) {
      const level = depths[i];
      let found = false;
      for (const interval of level) {
        if (year < interval.upper && upper > interval.lower) {
          found = true;
          break;
        }
      }
      if (!found) {
        level.push({uid: uid, title: title, summary: summary, lower: year, upper: upper});
        return i;
      }
    }
    depths.push([{uid: uid, title: title, summary: summary, lower: year, upper: upper}]);
    return depths.length - 1;
  }

  const currentUIDs = {};
  let rendered = false;

  function drawNodes() {
    const svg = document.getElementById('tree');
    const bottom = 40 + depths.length * (HEIGHT + HEIGHT_GAP);
    svg.setAttribute('width', 40 + (newest - oldest) * YEAR_WIDTH);
    svg.setAttribute('height', bottom);

    if (!rendered) {
      const axis = document.createElementNS('http://www.w3.org/2000/svg', 'line');
      axis.setAttribute('x1', 20);
      axis.setAttribute('y1', 20);
      axis.setAttribute('x2', 20 + (newest - oldest) * YEAR_WIDTH);
      axis.setAttribute('y2', 20);
      axis.classList.add('axis');
      svg.appendChild(axis);

      for (let year = 0; year <= newest - oldest; year++) {
        const x = 20 + year * YEAR_WIDTH;
        const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
        line.setAttribute('x1', x);
        line.setAttribute('y1', 20);
        line.setAttribute('x2', x);
        line.setAttribute('y2', 10000);
        line.classList.add('tick');
        svg.appendChild(line);

        const label = document.createElementNS('http://www.w3.org/2000/svg', 'text');
        label.setAttribute('x', x);
        label.setAttribute('y', 15);
        label.textContent = year + oldest;
        label.classList.add('label');
        svg.appendChild(label);
      }

      rendered = true;
    }

    for (let i = 0; i < depths.length; i++) {
      const level = depths[i];
      for (const interval of level) {
        const left = 20 + (interval.lower - oldest) * YEAR_WIDTH;
        const right = 20 + (interval.upper - oldest) * YEAR_WIDTH;
        const y = 40 + i * (HEIGHT + HEIGHT_GAP);

        if (currentUIDs[interval.uid] !== undefined) {
          const fo = currentUIDs[interval.uid];
          fo.setAttribute('x', left);
          fo.setAttribute('y', y);
          continue;
        }

        const fo = document.createElementNS('http://www.w3.org/2000/svg', 'foreignObject');
        fo.setAttribute('x', left);
        fo.setAttribute('y', y);
        fo.setAttribute('width', right - left);
        fo.setAttribute('height', HEIGHT);
        const div = document.createElement('div');
        div.classList.add('node');

        const title = document.createElement('h1');
        title.textContent = interval.title;
        div.appendChild(title);

        const summary = document.createElement('p');
        summary.textContent = interval.summary;
        div.appendChild(summary);
        
        fo.appendChild(div);
        svg.appendChild(fo);
        
        currentUIDs[interval.uid] = fo;
      }
    }
  }

  const lipsum = "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed sed velit nisi. Vivamus elementum tortor dolor, id mattis sapien dictum vel. Nunc elementum maximus ligula, eget dictum est ullamcorper id. Fusce sagittis pretium nulla id rhoncus. Suspendisse luctus turpis eu neque vestibulum gravida. Curabitur fringilla nisi sed suscipit gravida. Orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Ut mollis tempor quam, congue maximus ex ultricies nec. In convallis efficitur dignissim. Vivamus tempus vehicula augue, vitae volutpat lectus sodales sed. Nam vel auctor urna, et efficitur massa. Donec vitae malesuada tortor. Nulla convallis lacus tellus, in efficitur elit euismod non. Sed laoreet neque eros, convallis vestibulum augue convallis sed. Curabitur non tempor est, suscipit sodales orci."

  addNode('a', "A", lipsum, new Date(2020, 7, 21));
  addNode('e', "E", lipsum, new Date(2021, 8, 18));
  addNode('c', "C", lipsum, new Date(2022, 8, 5));
  addNode('b', "B", lipsum, new Date(2021, 0, 1));
  addNode('d', "D", lipsum, new Date(2023, 9, 10));

  drawNodes();
</script>

</body>