<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
<script type="module">
  import * as d3 from 'https://cdn.jsdelivr.net/npm/d3@7/+esm';

  var popoverTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'))
  var popoverList = popoverTriggerList.map(function (popoverTriggerEl) {
    return new bootstrap.Popover(popoverTriggerEl)
  })

  const treeData = {
    name: 'Root',
    year: new Date(2020, 0, 0),
    children: [
      {
        name: 'Branch 1', year: new Date(2018, 0, 0),
        children: [{ name: 'Leaf 1A', year: new Date(2016, 0, 0) }, { name: 'Leaf 1B' , year: new Date(2016, 0, 0)}],
      },
      {
        name: 'Branch 2', year: new Date(2018, 0, 0),
        children: [{ name: 'Leaf 2A', year: new Date(2013, 0, 0) }, { name: 'Leaf 2B', year: new Date(2016, 0, 0) }],
      },
    ],
  };

  const width = 800,
    height = 600;
  const svg = d3
    .select('#svg2')
    .attr('width', width)
    .attr('height', height)
    .append('g')
    .attr('transform', 'translate(0,70)');

  const scale = d3.scaleTime([new Date(2000, 0, 1), new Date(2020, 0, 1)], [0, width - 100]);
  d3.select("#svg2")
    .attr('width', width)
    .attr('height', height)
    .append('g')
    .attr("transform", `translate(0,20)`)
    .call(d3.axisTop(scale));

  // Create a D3 hierarchy from data
  const root = d3.hierarchy(treeData);

  // Create a tree layout
  const treeLayout = d3.tree().size([height - 100, width - 100]);
  treeLayout(root);

  console.log(root)

  const findX = (d) => {
    console.log(scale(d))
    return scale(d.data.year)
  };
  const findY = (d) => d.x - 100;

  // Draw links (edges between nodes)
  svg
    .selectAll('line')
    .data(root.links())
    .enter()
    .append('line')
    .attr('x1', (d) => findX(d.source))
    .attr('y1', (d) => findY(d.source))
    .attr('x2', (d) => findX(d.target))
    .attr('y2', (d) => findY(d.target))
    .attr('stroke', 'black');

  // Draw nodes (circles)
  svg
    .selectAll('circle')
    .data(root.descendants())
    .enter()
    .append('circle')
    .attr('fill', 'blue')
    .attr('cx', (d) => findX(d))
    .attr('cy', (d) => findY(d))
    .attr('r', 5)

  svg
    .selectAll('foreignObject')
    .data(root.descendants())
    .enter()
    .append('foreignObject')
    .attr('x', (d) => findX(d) - 5)
    .attr('y', (d) => findY(d) - 11)
    .attr('width', 50)
    .attr('height', 50)
    .each(function (d) {
    d3.select(this)
      .append('xhtml:button') // Use XHTML namespace
      .style('color', 'black') // Ensure text is visible
      .text('H')
      .attr('data-bs-toggle', 'popover')
      .attr('data-bs-container', 'body')
      .attr('data-bs-content', 'Haskell is fucking shit')
      .attr('title', 'The industrial revolution and its consequences ...')
      ;
  });
  // Add labels
  svg
    .selectAll('text')
    .data(root.descendants())
    .enter()
    .append('text')
    .attr('x', (d) => findX(d) + (d.children ? 10 : -50))
    .attr('y', (d) => findY(d) + 5)
    .text((d) => d.data.name)
    .style('font-size', '12px');
</script>

<svg id="svg1"></svg>
<svg id="svg2"></svg>
<button type="button"
    class="btn btn-lg btn-danger"
    data-bs-toggle="popover" data-bs-trigger="hover focus" title="Popover title" data-bs-content="And here's some amazing content. It's very engaging. Right?">Click to toggle popover</button>
